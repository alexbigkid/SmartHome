name: Deploy SmartHome web CI

on:
    push:
        branches:
            - dev
            - test
            - master


jobs:
    Deploy:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@master

            - name: Check setup
              run: |
                ls -la
                which bash
                echo "\$SHELL = $SHELL"
                bash --version
                which terraform
                terraform --version

            - name: dev branch?
              if:   endsWith(github.ref, '/dev')
              run:  echo "::set-env name=ENVIRONMENT::dev"
            - name: test branch?
              if:   endsWith(github.ref, '/test')
              run:  echo "::set-env name=ENVIRONMENT::test"
            - name: master branch aka prod?
              if:   endsWith(github.ref, '/master')
              run:  echo "::set-env name=ENVIRONMENT::prod"

            - name: Set REPOSITORY_NAME
              run:  echo ::set-env name=REPOSITORY_NAME::$(echo "$GITHUB_REPOSITORY" | awk -F / '{print $2}')
            #   run:  echo ::set-env name=REPOSITORY_NAME::$(echo "$GITHUB_REPOSITORY" | awk -F / '{print $2}' | tr '[:upper:]' '[:lower:]')

            - name: Set ABK_SUB_DOMAIN
              run:  echo ::set-env name=ABK_SUB_DOMAIN::$([ "$ENVIRONMENT" != "prod" ] && echo "$REPOSITORY_NAME-$ENVIRONMENT" || echo "$REPOSITORY_NAME")

            - name: "Print setup variables: "
              env:
                ABK_DOMAIN: abkcompany.com
              run: |
                echo "\$ENVIRONMENT     = $ENVIRONMENT"
                echo "\$REPOSITORY_NAME = $REPOSITORY_NAME"
                echo "\$ABK_DOMAIN      = $ABK_DOMAIN"
                echo "\$ABK_SUB_DOMAIN  = $REPOSITORY_NAME-$ENVIRONMENT"
                echo "\$ABK_SUB_DOMAIN  = $ABK_SUB_DOMAIN"
                echo "FULL_DOMAIN_NAME = ${ABK_SUB_DOMAIN,,}.$ABK_DOMAIN"

            - name: "Sync to hosting website: "
              run:  echo "test 1"
